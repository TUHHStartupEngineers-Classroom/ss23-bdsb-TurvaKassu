{
  "hash": "9926ef6170650d0389de228139f8a37b",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Kasper Valtonen\"\n---\n\n\nChallenge:\n\n1. Getting Instagam followers of single user. First we need to get the account id\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_6c92bf1389930cde2cd4427087fed7d9'}\n\n```{.r .cell-code}\n#First lets load all necessary libraries\nlibrary(tidyverse) # Main Package - Loads dplyr, purrr, etc.\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(rvest)     # HTML Hacking & Web Scraping\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'rvest'\n#> \n#> The following object is masked from 'package:readr':\n#> \n#>     guess_encoding\n```\n:::\n\n```{.r .cell-code}\nlibrary(xopen)     # Quickly opening URLs\nlibrary(jsonlite)  # converts JSON files to R objects\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'jsonlite'\n#> \n#> The following object is masked from 'package:purrr':\n#> \n#>     flatten\n```\n:::\n\n```{.r .cell-code}\nlibrary(glue)      # concatenate strings\nlibrary(stringi)   # character string/text processing\nlibrary(httr)      # http requests\n\n# Getting user id for \"Kassu_1999\"\nurl <- \"https://instagram47.p.rapidapi.com/get_user_id\"\n\nqueryString <- list(username = \"kassu_1999\")\n\nresponse <- VERB(\"GET\", url, query = queryString, add_headers('X-RapidAPI-Key' = '7d3612512fmsh3b8eaaed9d17621p163f47jsn474741263db5', 'X-RapidAPI-Host' = 'instagram47.p.rapidapi.com'), content_type(\"application/octet-stream\"))\n\nuser_id <- content(response, as=\"parsed\")$user_id\nuser_id\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> NULL\n```\n:::\n\n```{.r .cell-code}\n# Getting followers of user with user_id\nurl <- \"https://instagram47.p.rapidapi.com/user_followers\"\n\nqueryString <- list(userid = user_id)\n\nresponse <- VERB(\"GET\", url, query = queryString, add_headers('X-RapidAPI-Key' = '7d3612512fmsh3b8eaaed9d17621p163f47jsn474741263db5', 'X-RapidAPI-Host' = 'instagram47.p.rapidapi.com'), content_type(\"application/octet-stream\"))\n\n# Getting response to tibble\nresponse_content <- content(response, as = \"text\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> No encoding supplied: defaulting to UTF-8.\n```\n:::\n\n```{.r .cell-code}\nresponse_json <- fromJSON(response_content)\nfollowers <- response_json$body$edges\nfollowers_tbl <- head(as_tibble(followers), 10)\nfollowers_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[],\"data\":[],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\nPart 2: Scraping data from https://www.rosebikes.de/\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_a97a6cdf88cfbdb40e8e3b6fe122f2e6'}\n\n```{.r .cell-code}\n# Setting home parameters\nurl_home <- \"https://www.rosebikes.de/fahrräder\"\n\nhtml_home <- read_html(url_home)\n\n# Getting bike families\nbike_families_tbl <- html_home %>%\n  html_nodes(\".catalog-navigation__link\") %>%\n  html_attr('title') %>%\n  discard(.p = ~stringr::str_detect(.x,\"Sale|Bike Finder|Schnell verfügbare Bikes\")) %>%\n  enframe(name = \"position\", value = \"family_class\")\n\n# Gettin url's from same elements and adding domain\nbike_url_tbl <- html_home %>%\n  html_nodes(\".catalog-navigation__link\") %>%\n  html_attr('href') %>%\n  discard(.p = ~stringr::str_detect(.x,\"Sale|Bike Finder|Schnell verfügbare Bikes\")) %>%\n  enframe(name = \"position\", value = \"url\") %>%\n  mutate(\n    url = glue(\"https://www.rosebikes.de{url}\") )\n  \n\n# Joining two tibbles\nbike_families_url_tbl <- left_join(bike_families_tbl, bike_url_tbl)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(position)`\n```\n:::\n\n```{.r .cell-code}\n# Get url from first bike category\nmtb_category_url <- bike_families_url_tbl$url[1]\n\n# Get html of mtb category bikes\nmtb_html <- read_html(mtb_category_url)\n\n# Scrape price data from mtb category bikes\nmtb_price_tbl <- mtb_html %>%\n  html_nodes(\".catalog-category-bikes__price-title\") %>%\n  html_text() %>%\n  str_replace(\"^[^0-9]+\", \"\") %>%\n  str_replace(\"[^0-9]+$\", \"\") %>%\n  \n  enframe(name = \"position\", value = \"price\")\n\n# Scrape name data from mtb category bikes\nmtb_name_tbl <- mtb_html %>%\n  html_nodes(\"h4.basic-headline__title\") %>%\n  html_text() %>%\n  enframe(name = \"position\", value = \"name\")\n\n# Join the tibbles\nmtb_bikes_data_tbl <- left_join(mtb_name_tbl, mtb_price_tbl)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Joining with `by = join_by(position)`\n```\n:::\n\n```{.r .cell-code}\nmtb_bikes_data_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"position\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"price\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"COUNT SOLO\",\"3\":\"749,00\"},{\"1\":\"2\",\"2\":\"PSYCHO PATH\",\"3\":\"1.499,00\"},{\"1\":\"3\",\"2\":\"THRILL HILL\",\"3\":\"2.999,00\"},{\"1\":\"4\",\"2\":\"ROOT MILLER PLUS\",\"3\":\"4.999,00\"},{\"1\":\"5\",\"2\":\"GROUND CONTROL\",\"3\":\"1.999,00\"},{\"1\":\"6\",\"2\":\"ROOT MILLER\",\"3\":\"2.299,00\"},{\"1\":\"7\",\"2\":\"BONERO\",\"3\":\"1.499,00\"},{\"1\":\"8\",\"2\":\"SOUL FIRE\",\"3\":\"2.599,00\"},{\"1\":\"9\",\"2\":\"THE BRUCE\",\"3\":\"899,00\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}